<!-- Styles -->

<style>
    #chartdiv {
        width: 100%;
        height: 500px;
    }
</style>
<link href="https://fonts.googleapis.com/css?family=Song+Myung&display=swap" rel="stylesheet">
<!-- Resources -->

<!-- Resources -->
<script src="https://www.amcharts.com/lib/4/core.js"></script>
<script src="https://www.amcharts.com/lib/4/charts.js"></script>
<script src="https://www.amcharts.com/lib/4/themes/dataviz.js"></script>
<script src="https://www.amcharts.com/lib/4/themes/animated.js"></script>
<!-- <script src="https://www.amcharts.com/lib/4/themes/animated.js"></script> -->

<!-- {% load static %}
	<link rel="stylesheet" type="text/javascript" href="{% static "javascript/mouseevent.js" %}"> -->
<style>
    body {
        font-family: 'Song Myung', serif;
        font-weight: lighter;
    }
</style>

<!-- HTML -->
<div id="chartdiv"></div>

<h1 id="content">---</h1>
<h2>총 <span id="count">-</span>번의 거래를 통해, <span id="results_place">-</span>의 손익이 발생하였습니다.</h2>
<div id="trading_place"></div>

<script>
    am4core.ready(
        function ()
        {
// Themes begin
         am4core.useTheme(am4themes_dataviz);
// Themes end
        {var data = [];
        var visits = [];
        var b ={{ data }};
        var c = [];
        var chart_place = document.getElementById("chartdiv");
        var content = document.getElementById("content");
        var trading_place = document.getElementById("trading_place");
        var buy_at_s = [];
        var sell_at_s = [];
        var result = 0;
        var results = 0;
        var startTime;
        var j = 0;
        var p = 0;}
        {
            var current;
            var yields;
            var deltatime = 1000;
            var is_down = false;
            for (var i = 0; i <= 36; i++) {
                visits = c[i];
                data.push({date: new Date().setSeconds(i - 36), value: visits});
            }
        }
        { var chart = am4core.create("chartdiv", am4charts.XYChart);
        chart.hiddenState.properties.opacity = 0;
        chart.padding(0, 0, 0, 0);
        chart.zoomOutButton.disabled = true;
        chart.data = data;}
        {  var dateAxis = chart.xAxes.push(new am4charts.DateAxis());
        dateAxis.renderer.grid.template.disabled = true;
        dateAxis.renderer.grid.template.location = 0;
        dateAxis.renderer.minGridDistance = 30;
        dateAxis.renderer.disabled = true;
        var valueAxis = chart.yAxes.push(new am4charts.ValueAxis());
        valueAxis.tooltip.disabled = true;
        valueAxis.interpolationDuration = 0;
        valueAxis.rangeChangeDuration = 0;
        valueAxis.renderer.inside = true;
        valueAxis.renderer.minLabelPosition = 0.05;
        valueAxis.renderer.maxLabelPosition = 0.95;
        valueAxis.renderer.axisFills.template.disabled = true;
        valueAxis.renderer.ticks.template.disabled = true;
        var series = chart.series.push(new am4charts.StepLineSeries());
        series.strokeWidth = 6;
        series.propertyFields.stroke = "color";
        series.dataFields.dateX = "date";
        series.dataFields.valueY = "value";
        series.interpolationDuration = 0;
        series.defaultState.transitionDuration = 0;
        series.tensionX = 0.8;
        dateAxis.interpolationDuration = 0;
        dateAxis.rangeChangeDuration = 0;}
            function bgchange(is_down, yields) {
                if (is_down) {
                    if (yields > 0) {
                        content.style.color = "red";
                        document.body.style.backgroundColor = "rgba(051, 204, 051," + ((yields) / 1.5 / 100).toFixed(1) + ")"
                    } else if (yields < 0) {
                        content.style.color = "blue";
                        document.body.style.backgroundColor = "rgba(255, 051, 051," + ((-yields) * 1.5 / 100).toFixed(1) + ")"
                    } else {
                        content.style.color = 'black';
                        document.body.style.backgroundColor = "white"
                    }
                } else {
                    content.style.color = 'black'
                }
            }
            function calculate_yields(is_down, current, sell_at_s)
            {
                if (is_down)
                {
                    if (!(sell_at_s))
                    {
                        return (((current - buy_at_s[p]) / buy_at_s[p]) * 100).toFixed(2);
                    } else {
                        return (((sell_at_s[p] - buy_at_s[p]) / buy_at_s[p]) * 100).toFixed(2);
                    }
                }
            else
                {
                    return "---"
                }
            }
            function comments(yields) {
                if (yields > 0) {
                    if (yields > 0 && yields < 5) {
                        return "풉ㅋㅋ아직 은행 이자 수준이군요."
                    } else if (yields >= 5 && yields < 20) {
                        return "다같이, 영차영차!"
                    } else if (yields >= 20 && yields < 30) {
                        return "달달한 수익 구간입니다."
                    } else if (yields >= 30 && yields < 40) {
                        return "매수는 기술, 매도는 예술"
                    } else if (yields >= 40 && yields < 60) {
                        return "경제적 자유를 항해 가즈아-!"
                    } else if (yields >= 60 && yields < 80) {
                        return "지나친 욕심은 위험합니다."
                    } else if (yields >= 80 && yields < 100) {
                        return "정녕...당신은 한국의 워렌버핏입니까?"
                    } else if (yields >= 100 && yields < 120) {
                        return "축하합니다- 1루타!"
                    } else if (yields >= 120) {
                        return "장기 가치 투자는 언제나 환영입니다."
                    }
                } else if (yields < 0) {
                    if (yields < 0 && yields > -5) {
                        return "삐빅! 손실 구간입니다."
                    } else if (yields <= -5 && yields > -10) {
                        return "힘을 내요, 영차영차!"
                    } else if (yields <= -10 && yields > -20) {
                        return "손절은 나쁜 습관입니다."
                    } else if (yields <= -20 && yields > -30) {
                        return "팔기 전까진 가짜 손해입니다. 존버하세요!"
                    } else if (yields <= -30 && yields > -40) {
                        return "존버, 존버만이 살 길입니다."
                    } else if (yields <= -40 && yields > -50) {
                        return "해 뜨기 직전이 가장 어둡습니다."
                    } else if (yields <= -50 && yields > -60) {
                        return "삐빅! 현재 시각 한강물 온도 16.4도"
                    } else if (yields <= -60) {
                        return "아-멘"
                    }
                } else {
                    return "이제 시작이군요."
                }
            }
        {  chart_place.onmousedown = function () {
                is_down = true;
                div = document.createElement('div');
                div.setAttribute('id', 'div' + p);
                trading_place.insertBefore(div, trading_place.firstChild);
                buy_at_s[p] = b[j - 1];
                // console.log("매수가:"+buy_at);
                var buy_at_place = document.createElement('span');
                buy_at_place.innerHTML = (p + 1) + "번째 - " + "매수가: " + buy_at_s[p].toLocaleString() + " ";
                div.appendChild(buy_at_place);
                startTime = new Date().getTime();
                {#document.body.style.backgroundColor = "#A8F552"#}
            };
            chart_place.onmouseup = function () {
                is_down = false;
                div = document.getElementById('div' + p);
                sell_at_s[p] = b[j - 1];
                result = sell_at_s[p] - buy_at_s[p];
                yields = (((sell_at_s[p] - buy_at_s[p]) / buy_at_s[p]) * 100).toFixed(2);// console.log("매도가:"+sell_at)
                // console.log(buy_at+"에 매수해서 "+sell_at+"에 매도했습니다.")
                var sell_at_place = document.createElement('span');
                var endTime = new Date().getTime();
                var jonber_period = ((endTime - startTime) / 1000).toFixed(1);
                // console.log(endTime-startTime);
                sell_at_place.innerHTML = "매도가: " + sell_at_s[p].toLocaleString() + " " + "매매손익: " + result.toLocaleString() + "(원) " + " 수익률: " + yields + "(%) " + " 존버기간:" + jonber_period + "개월";
                div.appendChild(sell_at_place);
                p++;
                var count = document.getElementById('count');
                count.innerHTML = p;
                results += result;
                // content.innerHTML += (" "+sell_at)		// console.log(results)
                var results_place = document.getElementById("results_place");
                results_place.innerHTML = results;
                document.body.style.backgroundColor = "white";
            };}
// add data
            var interval = setInterval(function ()
            {
                if (j < b.length) {
                    visits = b[j];
                    var lastdataItem = series.dataItems.getIndex(series.dataItems.length - 1);
                    chart.addData(
                        {date: new Date(lastdataItem.dateX.getTime() + 1000), value: visits}, 1
                    );
                    content.innerHTML = b[j].toLocaleString();
                    content.innerHTML += " 현재 수익률: " + calculate_yields(is_down, b[j], sell_at_s[p]) + "% " + comments(calculate_yields(is_down, b[j], sell_at_s[p]));
                    bgchange(is_down, calculate_yields(is_down, b[j], sell_at_s[p]));
                    {#colorchange()#}
                    j++
                } else {
                    clearInterval(interval);
                }
            }, deltatime);
// all the below is optional, makes some fancy effects
// gradient fill of the series
            series.fillOpacity = 1.0;
            var gradient = new am4core.LinearGradient();
            gradient.addColor(chart.colors.getIndex(0), 0.2);
            gradient.addColor(chart.colors.getIndex(0), 0);
            series.fill = gradient;
        });

</script>


